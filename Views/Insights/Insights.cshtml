@model List<AttendanceSystem.Models.Subject> 
@{
    ViewData["Title"] = "Insights";
}

<h2 style="color:white;">Attendance Insights</h2>

<div style="display: flex; gap: 20px; align-items: flex-start; justify-content: center;">
    <div style="flex: 1; max-width: 500px;">
        <h3 style="color:white;">Attendance Status per Subject</h3>
        <canvas id="attendanceStatusChart" style="max-width: 100%; height: auto;"></canvas>
    </div>
    <div style="flex: 1; max-width: 500px;">
        <h4 style="color:white;">Total Attendance per Subject</h4>
        <canvas id="totalAttendanceChart" style="max-width: 100%; height: auto;"></canvas>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        fetch("/Insights/GetAttendanceData")
            .then(res => res.json())
            .then(data => {
                const labels = data.map(d => "Subject " + d.subjectId);
                const present = data.map(d => d.presentCount);
                const absent = data.map(d => d.absentCount);

                new Chart(document.getElementById('attendanceStatusChart'), {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [
                            { label: 'Present', data: present, backgroundColor: 'rgba(0, 153, 255, 0.7)' },
                            { label: 'Absent', data: absent, backgroundColor: 'rgba(255, 77, 77, 0.7)' }
                        ]
                    },
                    options: {
                        plugins: {
                            legend: { labels: { color: '#fff' } },
                            title: { display: false }
                        },
                        scales: {
                            x: { ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                            y: { ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                        }
                    }
                });

                const totals = data.map(d => d.presentCount + d.absentCount);
                new Chart(document.getElementById('totalAttendanceChart'), {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Total Attendance',
                            data: totals,
                            backgroundColor: 'rgba(102, 255, 204, 0.7)'
                        }]
                    },
                    options: {
                        plugins: {
                            legend: { labels: { color: '#fff' } },
                            title: { display: false }
                        },
                        scales: {
                            x: { ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                            y: { ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                        }
                    }
                });
            });
    });
</script>
